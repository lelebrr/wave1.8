<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WAVE PWN v2 — Web Config</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.ico">
  <style>
    .tabs {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border-bottom: 1px solid rgba(148,163,184,0.4);
      padding-bottom: 4px;
    }
    .tab-btn {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      opacity: 0.75;
    }
    .tab-btn.active {
      border-color: rgba(56,189,248,0.9);
      box-shadow: 0 0 12px rgba(56,189,248,0.7);
      opacity: 1;
    }
    .tab-content {
      display: none;
      margin-top: 10px;
      padding: 10px 12px 12px;
      border-radius: 14px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: 0 16px 32px rgba(15,23,42,0.9);
      font-size: 0.8rem;
    }
    .tab-content.active {
      display: block;
    }
    .field-group {
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .field-group label {
      font-size: 0.75rem;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .field-group input,
    .field-group select,
    .field-group textarea {
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      font-size: 0.8rem;
      font-family: inherit;
    }
    .field-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    .section-title {
      margin: 0 0 8px;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #e5e7eb;
    }
    .hint {
      font-size: 0.7rem;
      color: #9ca3af;
    }
    .pill {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-right: 6px;
    }
    .pill.ok {
      border-color: rgba(34,197,94,0.8);
      color: #bbf7d0;
    }
    .pill.warn {
      border-color: rgba(250,204,21,0.8);
      color: #fef3c7;
    }
    .pill.danger {
      border-color: rgba(248,113,113,0.9);
      color: #fee2e2;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .row > .field-group {
      flex: 1 1 160px;
    }
    .tiny-btn {
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .tiny-btn.primary {
      border-color: rgba(56,189,248,0.9);
      box-shadow: 0 0 12px rgba(56,189,248,0.7);
    }
    .tiny-btn.danger {
      border-color: rgba(248,113,113,0.9);
      color: #fecaca;
    }
    .section-footer {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    #gemini_response {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.95);
      min-height: 40px;
      white-space: pre-wrap;
      font-size: 0.78rem;
      color: #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="glow-bg"></div>
  <div class="scanlines"></div>

  <div class="container">
    <header class="header">
      <div class="title-wrap">
        <h1>WAVE PWN <span class="tag">CONFIG</span></h1>
        <span id="cfg-status" class="status-pill online">● CONFIG</span>
      </div>
      <div class="sub">
        <span class="badge">Web Config · ESP32‑S3</span>
        <span class="badge">NEURA9 · Lab Mode · Gemini</span>
        <span class="badge">Defensive‑First</span>
      </div>
    </header>

    <main class="layout">
      <section class="left">
        <div class="tabs">
          <button class="tab-btn active" data-tab="device">Device</button>
          <button class="tab-btn" data-tab="assistant">Assistant</button>
          <button class="tab-btn" data-tab="neura9">NEURA9</button>
          <button class="tab-btn" data-tab="lab">Lab Mode</button>
          <button class="tab-btn" data-tab="wifi">Wi‑Fi Attacks</button>
          <button class="tab-btn" data-tab="bt">Bluetooth Attacks</button>
          <button class="tab-btn" data-tab="gemini">Gemini AI</button>
          <button class="tab-btn" data-tab="ota">OTA &amp; Backup</button>
          <button class="tab-btn" data-tab="security">Security</button>
          <button class="tab-btn" data-tab="logs">Logs &amp; Reports</button>
          <button class="tab-btn" data-tab="eggs">Easter Eggs</button>
          <button class="tab-btn" data-tab="about">About</button>
        </div>

        <!-- Device Settings -->
        <div id="tab-device" class="tab-content active">
          <h2 class="section-title">Device Settings</h2>
          <div class="row">
            <div class="field-group">
              <label for="device_name">Nome do dispositivo</label>
              <input id="device_name" placeholder="CyberGuard Pro">
            </div>
            <div class="field-group">
              <label for="owner">Dono</label>
              <input id="owner" placeholder="Seu Nome">
            </div>
          </div>
          <div class="row">
            <div class="field-group">
              <label for="language">Idioma</label>
              <select id="language">
                <option value="pt-BR">pt-BR</option>
                <option value="en-US">en-US</option>
              </select>
            </div>
            <div class="field-group">
              <label for="theme">Tema</label>
              <select id="theme">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
              </select>
            </div>
          </div>
          <div class="field-group">
            <label>Alerts de voz</label>
            <select id="voice_alerts">
              <option value="true">Ativos</option>
              <option value="false">Desativados</option>
            </select>
          </div>
          <div class="section-footer">
            <button class="tiny-btn primary" onclick="saveDeviceConfig()">Salvar Device Settings</button>
          </div>
        </div>

        <!-- Assistant -->
        <div id="tab-assistant" class="tab-content">
          <h2 class="section-title">Assistant</h2>
          <div class="field-group">
            <label for="assistant">Assistente</label>
            <select id="assistant">
              <option value="none">Nenhum</option>
              <option value="alexa">Alexa</option>
              <option value="google">Google</option>
              <option value="both">Ambos</option>
            </select>
            <span class="hint">Controla integração com Alexa / Google Home.</span>
          </div>
          <div class="section-footer">
            <button class="tiny-btn primary" onclick="saveDeviceConfig()">Salvar Assistente</button>
          </div>
        </div>

        <!-- NEURA9 -->
        <div id="tab-neura9" class="tab-content">
          <h2 class="section-title">NEURA9</h2>
          <div class="field-group">
            <label for="neura9_sens">Sensibilidade</label>
            <input type="range" id="neura9_sens" min="0.1" max="1.0" step="0.01" value="0.78" oninput="updateSensLabel(this.value)">
            <span id="neura9_sens_label" class="hint">0.78 · equilíbrio entre falsos positivos e falsos negativos</span>
          </div>
          <p class="hint">
            Ajuste para tornar a NEURA9 mais conservadora (valores menores) ou
            mais agressiva na detecção de anomalias (valores maiores).
          </p>
          <div class="section-footer">
            <button class="tiny-btn primary" onclick="saveDeviceConfig()">Salvar Sensibilidade</button>
          </div>
        </div>

        <!-- Lab Mode -->
        <div id="tab-lab" class="tab-content">
          <h2 class="section-title">Lab Mode</h2>
          <p class="hint">
            O modo laboratório libera as <strong>simulações acadêmicas</strong> de ataques.
            Ele exige dois fatores:
          </p>
          <ul class="hint">
            <li>Arquivo de guarda <code>/sd/.enable_lab_attacks</code> no microSD.</li>
            <li>PIN de 6 dígitos desbloqueado nesta sessão.</li>
          </ul>

          <div style="margin:8px 0;">
            <span id="lab_guard_pill" class="pill">GUARD FILE</span>
            <span id="lab_pin_pill" class="pill">PIN</span>
            <span id="lab_unlocked_pill" class="pill">LAB MODE</span>
          </div>

          <div class="field-group">
            <label for="lab_pin_set">Definir/alterar PIN (6 dígitos)</label>
            <input id="lab_pin_set" type="password" maxlength="6" placeholder="******">
            <span class="hint">Use somente dígitos e armazene este PIN em local seguro.</span>
          </div>
          <div class="section-footer">
            <button class="tiny-btn primary" onclick="setLabPin()">Salvar PIN</button>
          </div>

          <div class="field-group" style="margin-top:10px;">
            <label for="lab_pin_unlock">Desbloquear Lab Mode (sessão atual)</label>
            <input id="lab_pin_unlock" type="password" maxlength="6" placeholder="PIN de 6 dígitos">
          </div>
          <div class="section-footer">
            <button class="tiny-btn primary" onclick="unlockLab()">Desbloquear</button>
          </div>
        </div>

        <!-- Wi-Fi Attacks (simulados) -->
        <div id="tab-wifi" class="tab-content">
          <h2 class="section-title">Wi‑Fi Attacks (SIMULAÇÕES)</h2>
          <p class="hint">
            Estes controles configuram apenas <strong>simulações acadêmicas</strong>.
            Nenhum frame malicioso real é enviado. O objetivo é alimentar dashboards,
            NEURA9 e relatórios de laboratório.
          </p>
          <ul class="hint">
            <li>Deauth Burst · Evil Twin · Beacon Spam · PMKID Flood</li>
            <li>WPS PIN (simulado) · Karma/MANA · WPA3 → WPA2 downgrade (simulado)</li>
          </ul>
          <p class="hint">
            A lógica detalhada das simulações está em <code>src/lab_simulations/</code>.
          </p>
        </div>

        <!-- Bluetooth Attacks (simulados) -->
        <div id="tab-bt" class="tab-content">
          <h2 class="section-title">Bluetooth Attacks (SIMULAÇÕES)</h2>
          <p class="hint">
            Simulações de cenários de saturação e HID injection para fins didáticos,
            sem interferência ou comandos reais:
          </p>
          <ul class="hint">
            <li>Name Spam (simulado)</li>
            <li>Jammer Full Band (simulado)</li>
            <li>Inquiry Flood (simulado)</li>
            <li>HID Injection (teclado simulado)</li>
          </ul>
        </div>

        <!-- Gemini AI -->
        <div id="tab-gemini" class="tab-content">
          <h2 class="section-title">Gemini AI Integration</h2>
          <div class="field-group">
            <label for="gemini_key">API Key</label>
            <input type="password" id="gemini_key" placeholder="API Key">
            <span class="hint">
              A chave é salva em <code>/config/gemini_key.txt</code> no microSD.
              Use apenas para ambientes de teste controlados.
            </span>
          </div>
          <div class="section-footer">
            <button class="tiny-btn primary" onclick="save_key()">Salvar</button>
          </div>

          <div class="field-group" style="margin-top:10px;">
            <label for="prompt">Prompt para análise</label>
            <textarea id="prompt">Analise este log de laboratório e descreva riscos em linguagem simples.</textarea>
            <span class="hint">
              Evite enviar payloads completos ou dados pessoais. Prefira resumos,
              estatísticas e descrições de cenários.
            </span>
          </div>
          <div class="section-footer">
            <button class="tiny-btn primary" onclick="ask_gemini()">Enviar ao Gemini</button>
          </div>
          <div id="gemini_response"></div>
        </div>

        <!-- OTA & Backup -->
        <div id="tab-ota" class="tab-content">
          <h2 class="section-title">OTA &amp; Backup</h2>
          <p class="hint">
            Atualize o firmware e faça backup dos relatórios usando rotas já
            existentes do WavePwn.
          </p>
          <ul class="hint">
            <li>OTA: <code>/ota/update.html</code> (protegido por senha)</li>
            <li>Relatórios em PDF: <code>/sd/reports/</code></li>
            <li>Capturas técnicas: <code>/sd/wavepwn/</code></li>
          </ul>
        </div>

        <!-- Security -->
        <div id="tab-security" class="tab-content">
          <h2 class="section-title">Security</h2>
          <p class="hint">
            Consulte <code>docs/SECURITY_POLICY.md</code> para os princípios
            de uso defensivo, anti‑tamper e boas práticas de OTA.
          </p>
          <p class="hint">
            Recomenda-se alterar credenciais OTA, proteger fisicamente o
            microSD e manter o firmware sempre assinado em builds de produção.
          </p>
        </div>

        <!-- Logs & Reports -->
        <div id="tab-logs" class="tab-content">
          <h2 class="section-title">Logs &amp; Reports</h2>
          <p class="hint">
            Os principais diretórios no microSD são:
          </p>
          <ul class="hint">
            <li><code>/sd/wavepwn/handshakes</code> · capturas técnicas</li>
            <li><code>/sd/wavepwn/pmkid</code> · PMKID prontos para Hashcat</li>
            <li><code>/sd/lab_logs</code> · logs das simulações de laboratório</li>
            <li><code>/sd/reports</code> · relatórios simplificados em "PDF"</li>
          </ul>
        </div>

        <!-- Easter Eggs -->
        <div id="tab-eggs" class="tab-content">
          <h2 class="section-title">Easter Eggs</h2>
          <p class="hint">
            O WavePwn inclui Easter Eggs como o <strong>Konami GODMODE</strong>,
            descrito no código em <code>easter_egg/konami_godmode.cpp</code>.
          </p>
          <p class="hint">
            Esses recursos nunca habilitam ataques reais; apenas desbloqueiam
            camadas extras de visual e proteção de logs em modo laboratório.
          </p>
        </div>

        <!-- About -->
        <div id="tab-about" class="tab-content">
          <h2 class="section-title">About</h2>
          <p class="hint">
            WavePwn v2 · NEURA9 Defensive Grid · ESP32‑S3 Touch AMOLED.
          </p>
          <p class="hint">
            Este painel foi projetado para centralizar configurações em um
            único lugar, mantendo o foco em <strong>defesa</strong>,
            <strong>ética</strong> e <strong>experimentação controlada</strong>.
          </p>
        </div>
      </section>

      <section class="right">
        <div class="logs">
          <div class="logs-header">
            <span>Config Log</span>
            <span id="cfg-log-counter" class="logs-counter">0 eventos</span>
          </div>
          <pre id="cfg-log" class="logs-body"></pre>
        </div>
        <div class="actions">
          <button class="btn primary" onclick="location.href='/'">
            VOLTAR AO DASHBOARD
          </button>
          <button class="btn ghost" onclick="location.reload()">
            RECARREGAR CONFIG
          </button>
        </div>
        <div class="footer">
          <span>WAVE PWN v2 · Web Config · 100% defensivo por design</span>
        </div>
      </section>
    </main>
  </div>

<script>
  const tabButtons = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');
  const logEl = document.getElementById('cfg-log');
  const logCounterEl = document.getElementById('cfg-log-counter');

  let logCount = 0;

  function appendLog(msg) {
    if (!msg) return;
    logCount++;
    logCounterEl.textContent = logCount + ' eventos';
    const atBottom = logEl.scrollHeight - logEl.scrollTop - logEl.clientHeight < 8;
    logEl.textContent += msg + '\\n';
    if (logEl.textContent.length > 8000) {
      logEl.textContent = logEl.textContent.slice(-8000);
    }
    if (atBottom) {
      logEl.scrollTop = logEl.scrollHeight;
    }
  }

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.getAttribute('data-tab');
      tabButtons.forEach(b => b.classList.toggle('active', b === btn));
      tabContents.forEach(c => c.classList.toggle('active', c.id === 'tab-' + target));
    });
  });

  function updateSensLabel(v) {
    const el = document.getElementById('neura9_sens_label');
    el.textContent = `${Number(v).toFixed(2)} · sensibilidade da NEURA9`;
  }

  async function loadDeviceConfig() {
    try {
      const res = await fetch('/api/config/device');
      if (!res.ok) {
        appendLog('[CFG] Falha ao carregar device_config.json');
        return;
      }
      const cfg = await res.json();
      document.getElementById('device_name').value = cfg.device_name || 'CyberGuard Pro';
      document.getElementById('owner').value = cfg.owner || '';
      document.getElementById('language').value = cfg.language || 'pt-BR';
      document.getElementById('theme').value = cfg.theme || 'dark';
      document.getElementById('assistant').value = cfg.assistant || 'none';
      document.getElementById('voice_alerts').value =
        (typeof cfg.enable_voice_alerts === 'boolean'
          ? String(cfg.enable_voice_alerts)
          : 'true');
      const sens = typeof cfg.neura9_sensitivity === 'number'
        ? cfg.neura9_sensitivity
        : 0.78;
      const sensSlider = document.getElementById('neura9_sens');
      sensSlider.value = sens;
      updateSensLabel(sens);
      appendLog('[CFG] device_config.json carregado');
    } catch (e) {
      appendLog('[CFG] Erro ao carregar config: ' + e);
    }
  }

  async function saveDeviceConfig() {
    const body = {
      device_name: document.getElementById('device_name').value || 'CyberGuard Pro',
      owner: document.getElementById('owner').value || '',
      language: document.getElementById('language').value || 'pt-BR',
      theme: document.getElementById('theme').value || 'dark',
      assistant: document.getElementById('assistant').value || 'none',
      enable_voice_alerts: document.getElementById('voice_alerts').value === 'true',
      neura9_sensitivity: Number(document.getElementById('neura9_sens').value) || 0.78
    };

    try {
      const res = await fetch('/api/config/device', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(body)
      });
      if (!res.ok) {
        appendLog('[CFG] Falha ao salvar device_config.json (' + res.status + ')');
        return;
      }
      appendLog('[CFG] device_config.json salvo com sucesso');
    } catch (e) {
      appendLog('[CFG] Erro ao salvar config: ' + e);
    }
  }

  async function loadLabStatus() {
    try {
      const res = await fetch('/api/lab/status');
      if (!res.ok) {
        appendLog('[LAB] Falha ao consultar status do Lab Mode');
        return;
      }
      const st = await res.json();
      const guard = document.getElementById('lab_guard_pill');
      const pin = document.getElementById('lab_pin_pill');
      const unlocked = document.getElementById('lab_unlocked_pill');

      guard.classList.toggle('ok', !!st.lab_guard_file);
      guard.classList.toggle('danger', !st.lab_guard_file);
      guard.textContent = st.lab_guard_file ? 'GUARD FILE OK' : 'GUARD FILE AUSENTE';

      pin.classList.toggle('ok', !!st.pin_set);
      pin.classList.toggle('warn', !st.pin_set);
      pin.textContent = st.pin_set ? 'PIN CONFIGURADO' : 'PIN NAO DEFINIDO';

      unlocked.classList.toggle('ok', !!st.lab_unlocked);
      unlocked.classList.toggle('warn', !st.lab_unlocked);
      unlocked.textContent = st.lab_unlocked ? 'LAB UNLOCKED' : 'LAB BLOQUEADO';

      appendLog('[LAB] Status: guard=' + st.lab_guard_file +
                ', pin_set=' + st.pin_set +
                ', unlocked=' + st.lab_unlocked);
    } catch (e) {
      appendLog('[LAB] Erro ao consultar Lab Mode: ' + e);
    }
  }

  function isSixDigitPin(s) {
    return /^[0-9]{6}$/.test(s || '');
  }

  async function setLabPin() {
    const pin = document.getElementById('lab_pin_set').value.trim();
    if (!isSixDigitPin(pin)) {
      appendLog('[LAB] PIN inválido: use exatamente 6 dígitos');
      return;
    }

    try {
      const res = await fetch('/api/lab/set_pin', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({pin})
      });
      if (!res.ok) {
        appendLog('[LAB] Falha ao salvar PIN (' + res.status + ')');
        return;
      }
      appendLog('[LAB] PIN salvo com sucesso em /config/lab_config.json');
      document.getElementById('lab_pin_set').value = '';
      loadLabStatus();
    } catch (e) {
      appendLog('[LAB] Erro ao salvar PIN: ' + e);
    }
  }

  async function unlockLab() {
    const pin = document.getElementById('lab_pin_unlock').value.trim();
    if (!isSixDigitPin(pin)) {
      appendLog('[LAB] PIN inválido para desbloqueio');
      return;
    }

    try {
      const res = await fetch('/api/lab/unlock', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({pin})
      });
      const j = await res.json().catch(() => ({}));
      if (!res.ok || !j.ok) {
        appendLog('[LAB] Desbloqueio negado: ' + (j.error || res.status));
        return;
      }
      appendLog('[LAB] Lab Mode desbloqueado para a sessão atual');
      document.getElementById('lab_pin_unlock').value = '';
      loadLabStatus();
    } catch (e) {
      appendLog('[LAB] Erro ao desbloquear Lab Mode: ' + e);
    }
  }

  async function save_key() {
    const key = document.getElementById('gemini_key').value.trim();
    if (!key) {
      appendLog('[Gemini] Nenhuma chave informada');
      return;
    }
    try {
      const res = await fetch('/api/gemini/key', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({key})
      });
      if (!res.ok) {
        appendLog('[Gemini] Falha ao salvar chave (' + res.status + ')');
        return;
      }
      appendLog('[Gemini] Chave salva em /config/gemini_key.txt');
      document.getElementById('gemini_key').value = '';
    } catch (e) {
      appendLog('[Gemini] Erro ao salvar chave: ' + e);
    }
  }

  async function ask_gemini() {
    const prompt = document.getElementById('prompt').value;
    if (!prompt.trim()) {
      appendLog('[Gemini] Prompt vazio');
      return;
    }

    try {
      appendLog('[Gemini] Enviando prompt para Gemini...');
      const res = await fetch('/api/gemini/ask', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({prompt})
      });
      if (!res.ok) {
        appendLog('[Gemini] Falha na chamada (' + res.status + ')');
        return;
      }
      const j = await res.json();
      document.getElementById('gemini_response').textContent = j.response || '(sem resposta)';
      appendLog('[Gemini] Resposta recebida');
    } catch (e) {
      appendLog('[Gemini] Erro ao chamar Gemini: ' + e);
    }
  }

  window.addEventListener('load', () => {
    loadDeviceConfig();
    loadLabStatus();
  });
</script>
</body>
</html>