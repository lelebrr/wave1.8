<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WavePwn v2 — Config</title>

  <!-- Bootstrap 5 (CDN) + tema cyberpunk próprio -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  >
  <link href="style.css" rel="stylesheet">
  <link rel="icon" href="favicon.ico">

  <style>
    body.bg-dark {
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    .text-cyan {
      color: #22d3ee;
    }

    .wp-card {
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.9);
      box-shadow: 0 18px 40px rgba(15,23,42,0.95);
    }

    .wp-card-header {
      border-bottom: 1px solid rgba(148,163,184,0.3);
    }

    .nav-tabs .nav-link {
      border-radius: 999px 999px 0 0;
      border: 1px solid transparent;
      color: #cbd5f5;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.76rem;
      padding: 0.4rem 0.9rem;
    }

    .nav-tabs .nav-link.active {
      color: #22d3ee;
      border-color: rgba(56,189,248,0.8) rgba(56,189,248,0.8) #0f172a;
      background: radial-gradient(circle at top, rgba(56,189,248,0.35), #020617);
      box-shadow: 0 0 14px rgba(56,189,248,0.8);
    }

    .form-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .form-control,
    .form-select {
      background: rgba(15,23,42,0.95);
      border-radius: 0.6rem;
      border-color: rgba(75,85,99,0.9);
      color: #e5e7eb;
      font-size: 0.86rem;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: rgba(56,189,248,0.9);
      box-shadow: 0 0 0 0.1rem rgba(56,189,248,0.4);
      background: rgba(15,23,42,0.98);
      color: #f9fafb;
    }

    .form-text {
      font-size: 0.72rem;
    }

    .badge-soft {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.85);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .neura9-range {
      accent-color: #22d3ee;
    }

    .tab-pane {
      padding-top: 1rem;
    }

    #neura9_sens_label {
      font-size: 0.78rem;
      color: #9ca3af;
    }

    #lab_status,
    #gemini_status {
      font-size: 0.8rem;
    }

    .btn-save-all {
      letter-spacing: 0.12em;
    }
  </style>
</head>
<body class="bg-dark text-cyan">
<div class="glow-bg"></div>
<div class="scanlines"></div>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="wp-card">
        <div class="wp-card-header px-4 pt-3 pb-2 d-flex flex-column flex-md-row align-items-md-center justify-content-between">
          <div>
            <h1 class="h4 mb-1 text-cyan text-uppercase" style="letter-spacing:0.18em;">
              WAVE PWN v2 — CONFIG
            </h1>
            <div class="small text-muted">
              ESP32‑S3 · NEURA9 · Lab Mode · Gemini AI
            </div>
          </div>
          <div class="mt-3 mt-md-0 text-md-end">
            <span class="badge-soft me-2">Web Config</span>
            <span class="badge-soft">Defensive‑First</span>
          </div>
        </div>

        <div class="px-4 pt-3 pb-4">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs" id="configTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="device-tab" data-bs-toggle="tab"
                      data-bs-target="#device" type="button" role="tab">
                Dispositivo
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="assistant-tab" data-bs-toggle="tab"
                      data-bs-target="#assistant" type="button" role="tab">
                Assistente
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="neura9-tab" data-bs-toggle="tab"
                      data-bs-target="#neura9" type="button" role="tab">
                NEURA9
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="lab-tab" data-bs-toggle="tab"
                      data-bs-target="#lab" type="button" role="tab">
                Lab Mode
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="gemini-tab" data-bs-toggle="tab"
                      data-bs-target="#gemini" type="button" role="tab">
                Gemini AI
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="security-tab" data-bs-toggle="tab"
                      data-bs-target="#security" type="button" role="tab">
                Segurança
              </button>
            </li>
          </ul>

          <!-- Tab panes -->
          <div class="tab-content mt-3">
            <!-- Dispositivo -->
            <div class="tab-pane fade show active" id="device" role="tabpanel" aria-labelledby="device-tab">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="device_name" class="form-label">Nome do Dispositivo</label>
                  <input type="text" id="device_name" class="form-control" placeholder="WavePwn">
                  <div class="form-text">
                    Este nome aparece na Alexa / Google Home e em relatórios.
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="owner" class="form-label">Dono</label>
                  <input type="text" id="owner" class="form-control" placeholder="Seu nome">
                  <div class="form-text">
                    Apenas para uso interno em relatórios e logs.
                  </div>
                </div>
              </div>

              <div class="row g-3 mt-1">
                <div class="col-md-4">
                  <label for="lang" class="form-label">Idioma</label>
                  <select id="lang" class="form-select">
                    <option value="pt-BR">pt-BR</option>
                    <option value="en-US">en-US</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="theme" class="form-label">Tema</label>
                  <select id="theme" class="form-select">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="voice_alerts" class="form-label">Alertas de voz</label>
                  <select id="voice_alerts" class="form-select">
                    <option value="true">Ativos</option>
                    <option value="false">Desativados</option>
                  </select>
                  <div class="form-text">
                    Resumos periódicos falados pelos assistentes.
                  </div>
                </div>
              </div>
            </div>

            <!-- Assistente -->
            <div class="tab-pane fade" id="assistant" role="tabpanel" aria-labelledby="assistant-tab">
              <div class="mb-3">
                <label for="assistant" class="form-label">Assistente de voz</label>
                <select id="assistant" class="form-select">
                  <option value="none">Nenhum</option>
                  <option value="alexa">Alexa</option>
                  <option value="google">Google Home</option>
                  <option value="both">Ambos</option>
                </select>
                <div class="form-text">
                  Integração local via fauxmoESP e Home Assistant. Nenhum tráfego é enviado
                  à nuvem além do já exigido pelos próprios assistentes.
                </div>
              </div>
            </div>

            <!-- NEURA9 -->
            <div class="tab-pane fade" id="neura9" role="tabpanel" aria-labelledby="neura9-tab">
              <div class="mb-3">
                <label for="neura9_sens" class="form-label">Sensibilidade da NEURA9</label>
                <input type="range" class="form-range neura9-range"
                       id="neura9_sens" min="0.10" max="1.00" step="0.01"
                       oninput="update_neura9_label(this.value)">
                <div id="neura9_sens_label" class="form-text">
                  0.78 · equilíbrio entre falsos positivos e falsos negativos.
                </div>
              </div>
              <div class="form-text">
                Valores menores tornam a IA mais conservadora; valores próximos de 1.0
                tornam a NEURA9 mais agressiva na identificação de anomalias.
              </div>
            </div>

            <!-- Lab Mode -->
            <div class="tab-pane fade" id="lab" role="tabpanel" aria-labelledby="lab-tab">
              <div class="alert alert-danger mb-3">
                <strong>MODO LABORATÓRIO — APENAS COM AUTORIZAÇÃO.</strong><br>
                Tudo aqui é simulação acadêmica, mas ainda assim exige cuidado.
              </div>
              <p class="form-text mb-2">
                Para ativar o Lab Mode são necessários dois fatores:
              </p>
              <ul class="form-text mb-3">
                <li>Arquivo de guarda <code>/sd/.enable_lab_attacks</code> no microSD.</li>
                <li>PIN de 6 dígitos desbloqueado nesta sessão.</li>
              </ul>

              <div class="mb-3">
                <label for="lab_pin" class="form-label">PIN de 6 dígitos</label>
                <input type="password" id="lab_pin" maxlength="6" class="form-control" placeholder="******">
                <div class="form-text">
                  Usado para definir/atualizar o PIN e desbloquear o Lab Mode na sessão atual.
                </div>
              </div>
              <div class="d-flex gap-2">
                <button class="btn btn-danger" type="button" onclick="enable_lab()">
                  ATIVAR LAB MODE
                </button>
                <button class="btn btn-outline-light btn-sm" type="button" onclick="refresh_lab_status()">
                  Atualizar status
                </button>
              </div>
              <div id="lab_status" class="mt-3"></div>
            </div>

            <!-- Gemini -->
            <div class="tab-pane fade" id="gemini" role="tabpanel" aria-labelledby="gemini-tab">
              <div class="mb-3">
                <label for="gemini_key" class="form-label">Gemini API Key</label>
                <input type="password" id="gemini_key" class="form-control" placeholder="API Key">
                <div class="form-text">
                  A chave é salva em <code>/config/gemini_key.txt</code> no microSD.
                  Use apenas para ambientes de laboratório controlado.
                </div>
              </div>
              <div class="d-flex gap-2 mb-3">
                <button class="btn btn-primary" type="button" onclick="test_gemini()">
                  TESTAR CONEXÃO
                </button>
              </div>
              <div id="gemini_status"></div>
            </div>

            <!-- Segurança -->
            <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="security-tab">
              <p class="form-text mb-2">
                Consulte <code>docs/SECURITY_POLICY.md</code> para detalhes sobre
                uso defensivo, anti‑tamper e boas práticas de OTA.
              </p>
              <ul class="form-text">
                <li>Alterar a senha padrão do AP e da interface OTA.</li>
                <li>Proteger fisicamente o microSD (especialmente a pasta <code>/sd/wavepwn</code>).</li>
                <li>Manter o firmware assinado quando o secure boot estiver habilitado.</li>
              </ul>
            </div>
          </div>

          <div class="text-center mt-4">
            <button class="btn btn-success btn-lg btn-save-all" type="button" onclick="save_all()">
              SALVAR TUDO E REINICIAR
            </button>
          </div>
        </div>
      </div>

      <div class="text-end text-muted small mt-2">
        WavePwn v2 · Web Config · 100% defensivo por design
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="config.js"></script>
</body>
</html>